---
layout: post
title: Git学习笔记（新）
date: 2019-03-16
tags: 编程 git
---

[TOC]



## 1、Git简介

Git是分布式版本控制系统。

与之相对的是集中式版本控制。

集中式版本控制，即所有版本都储存在一台服务器里，每次获取版本都要联网，效率低下。

Git则在本地创建了版本库，联网与否无所谓。可以在本地多次修改版本，联网时再往远程仓库push。

## 2、[安装Git](https://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/00137396287703354d8c6c01c904c7d9ff056ae23da865a000)

## 3、[创建版本库](https://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/0013743256916071d599b3aed534aaab22a0db6c4e07fd0000)

版本库，也叫仓库，英文即repository。Git会记录下版本库里每个文件的修改、删除情况。

### 3.1 创建一个版本库：

选择一个位置，比如C:/Users/peng，在gitbash中输入：

```git
mkdir learngit
cd learngit
pwd
```

第二步，通过git init把目录初始化成Git可以管理的仓库：

```git
git init
```

这样就在`C:/Users/peng`中创建了一个名为`learngit`的仓库，现在的位置为`C:/Users/peng/learngit`

### 3.2 把文件添加到版本库：

先编写一个文件，比如readme.txt，放入learngit文件夹中。一定要放在仓库所在文件夹，不然Git找不到。

把文件放入Git仓库，分为两步：

第一步：把文件添加到仓库

```git
git add read.txt
```

第二步：把文件提交到仓库

```git
git commit -m "wrote a readme file"
```

注：-m 后可以写任何内容，但最好是本次提交的说明，方便自己以后查阅及他人理解。

`commit`可以一次提交多个内容，所以可以`add`多个文件后，一次性提交。

## 4、[管理版本](https://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/0013743858312764dca7ad6d0754f76aa562e3789478044000)

要掌握仓库当前的修改状态，可以输入

```git
git status
```

若文件有改动，比如`readme.txt`有改动，会现实 `modified：readme.txt`

要查看具体修改了什么内容，可以输入

```git
git diff
```

git会标出哪行文字做了修改。

### 4.1 [版本回退](https://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/0013744142037508cf42e51debf49668810645e02887691000)

就像打游戏可以存档一样，Git每次的`commit`都是一个“存档”，如果文件改乱了，就可以“读档”，即从最近的一个`commit`恢复。

要查看版本更改、提交的历史记录，可以输入

```git
git log
```

想让输出信息简化美观，可以输入

```git
git log --pretty=oneline
```

我们看到的一长串类似`1084ab5d`的是`commit id`（版本号）。

#### 4.1.1 版本回退：

在Git中，用HEAD表示当前版本，上一个版本就是`HEAD^`，上上个版本就是`HEAD^^`，往上100个版本用`HEAD~100`，所以上一个版本也能用`HEAD~1`，上上个版本就是`HEAD~2`。

```git
git reset --hard HEAD^
```

回退后，再用`git log`指令查看时，最新版本的历史记录会消失。如果想再次回到最新版本，怎么办？

1）如果命令行没关掉，往上翻找，找到最新那个`commit id`是`1094adb`，就可以回到最新版本

```git
git reset --hard 1094a
```

版本号没必要写全。

2）如果关掉了命令行，想要恢复到最新版本，可以用

```git
git reflog
```

`git reflog`记录了每一次的命令。找到`commit id`，用第一种方法回到版本。

### 4.2 [工作区和暂存区](https://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/0013745374151782eb658c5a5ca454eaa451661275886c6000)

**工作区**，即电脑里的目录，比如learngit就是一个工作区。

**版本库**，工作区的一个隐藏目录`.git`，这个不算工作区，而是Git的版本库。

![工作原理](http://prcinp6hs.bkt.clouddn.com/0.jpg)

版本库里最重要的东西有几个：

1）名为`stage`（或者叫index）的**暂存区**

2）自动创建的第一个分支`master`

3）指向`master`的一个指针`HEAD`

工作流程是，

- `git add` 添加文件，实际是就是将文件放入暂存区stage，
- `git commit`提交更改，实际就是把暂存区的所有内容提交到当前分支。

### 4.3 [管理修改](https://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/001374829472990293f16b45df14f35b94b3e8a026220c5000)

Git跟踪并管理的是**修改**，而非文件。

第一次修改 —> `git add` —> 第二次修改 —> `git commit` 

上面的第二次修改没被放入缓存区，即第二次修改不会被提交。

第一次修改 —> `git add` —> 第二次修改—> `git add` —>`git commit` 

上面的第二次修改被提交了。

### 4.4 [撤销修改](https://www.liaoxuefeng.com/wiki/896043488029600/897889638509536)

#### 4.4.1 撤销工作区的修改

使用`git checkout -- file`可以丢弃工作区的修改：

```git
git checkout -- readme.txt
```

这个指令的意思是，把文件在**工作区的修改**全部撤销，

第一种，即`readme.txt`修改后还没放到暂存区，撤销后就回到和版本库一模一样的状态；

第二种，即`readme.txt`**添加到暂存区后**，又做了修改，撤销后就回到**添加到暂存区后**的状态。

能让我们退回到`git add`或`git commit`时的状态。

注： `--` 很重要，不能缺，否则会变成另一个指令。

用自己的话说就是，如果你在工作区修改了，还没git add，就退回修改前状态；如果添加到暂存区后，又修改了，那就删除这些修改，回到你刚添加到暂存区的状态。

这就有个问题，如果你在工作去修改后，并且已经用git add将文件添加到暂存区，怎么办？

#### 4.4.2 撤销暂存区的修改

如果是在commit之前发现这个问题，还有机会。

你可以用`git reset HEAD <file>`把暂存区的修改撤销掉（unstage）

```git
git reset HEAD readme.txt
```

`git reset` 命令既可以回退版本，还可以把暂存区的修改回退到工作区。HEAD表示最新版本。

用`git status`查看，你会发现，**暂存区是干净的，工作区有修改**。

如果还想撤销工作区的修改，见4.4.1.

如果你不但改错了东西，还从暂存区commit到了版本库，怎么办？

可以用**版本回退**，回到上个版本。见4.1.1

但这有一个前提，就是你没有将本地版本库推送到远程库。





